name: Build and Deploy
on: [push]
permissions:
  contents: write
jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4

      - name: Install and Build 🔧
        run: |
          npm ci
          npm run build
          # 检查 build 目录是否存在
          if [ ! -d "build" ]; then
            echo "Error: Build directory does not exist."
            exit 1
          fi

      - name: Display Build Directory Contents 📚
        run: |
          ls -la build
          # 如果 build 目录为空，返回错误
          if [ -z "$(ls -A build)" ]; then
            echo "Error: Build directory is empty."
            exit 1
          fi

      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: build
          # 确保 branch 是正确的，通常是 gh-pages 或者其他你用来部署的分支
          branch: gh-pages